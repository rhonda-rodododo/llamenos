; ============================================================
; Dialplan for Llamenos Hotline
; ============================================================
; All incoming calls are routed to the Stasis application
; "llamenos", which is handled by the ARI bridge service.
;
; Place this file in /etc/asterisk/extensions.conf
; ============================================================

[general]
static = yes
writeprotect = no
clearglobalvars = no

; ----------------------------------------------------------
; Default context â€” reject everything not explicitly routed
; ----------------------------------------------------------
[default]
exten => _X.,1,NoOp(Rejecting unrouted call to ${EXTEN})
 same => n,Congestion()
 same => n,Hangup()

; ----------------------------------------------------------
; Incoming calls from SIP trunk(s)
; ----------------------------------------------------------
; All incoming calls go directly into the Stasis app.
; The bridge service handles IVR, routing, and bridging.
[from-trunk]
exten => _X.,1,NoOp(Incoming call from ${CALLERID(num)} to ${EXTEN})
 same => n,Answer()
 same => n,Stasis(llamenos)
 same => n,Hangup()

; Catch-all for the incoming context
exten => _+X.,1,NoOp(Incoming call from ${CALLERID(num)} to ${EXTEN})
 same => n,Answer()
 same => n,Stasis(llamenos)
 same => n,Hangup()

; ----------------------------------------------------------
; Internal extensions (for testing / volunteer SIP phones)
; ----------------------------------------------------------
[internal]
; Route internal calls through Stasis for testing
exten => _X.,1,NoOp(Internal call from ${CALLERID(num)} to ${EXTEN})
 same => n,Stasis(llamenos)
 same => n,Hangup()

; ----------------------------------------------------------
; Outgoing calls (bridge originates these for volunteer ringing)
; ----------------------------------------------------------
; The ARI bridge originates calls directly via PJSIP, so this
; context is only needed if using chan_sip or AMI fallbacks.
[to-trunk]
exten => _+X.,1,NoOp(Outgoing call to ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN}@trunk,30)
 same => n,Hangup()

exten => _X.,1,NoOp(Outgoing call to ${EXTEN})
 same => n,Dial(PJSIP/${EXTEN}@trunk,30)
 same => n,Hangup()
