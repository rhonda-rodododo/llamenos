; ============================================================
; PJSIP Configuration for Llamenos
; ============================================================
; Configures SIP trunking and transport for the hotline.
; Adapt the trunk credentials to your SIP provider.
;
; Place this file in /etc/asterisk/pjsip.conf
; ============================================================

; ----------------------------------------------------------
; Transport — UDP on port 5060
; ----------------------------------------------------------
[transport-udp]
type = transport
protocol = udp
bind = 0.0.0.0:5060

; ----------------------------------------------------------
; Transport — TCP on port 5060 (recommended for reliability)
; ----------------------------------------------------------
[transport-tcp]
type = transport
protocol = tcp
bind = 0.0.0.0:5060

; ----------------------------------------------------------
; Transport — TLS on port 5061 (recommended for production)
; ----------------------------------------------------------
; Uncomment and configure for TLS:
;[transport-tls]
;type = transport
;protocol = tls
;bind = 0.0.0.0:5061
;cert_file = /etc/asterisk/keys/asterisk.pem
;ca_list_file = /etc/asterisk/keys/ca.crt
;method = tlsv1_2

; ===========================================================
; SIP Trunk — Replace with your provider's details
; ===========================================================
; Example: Generic SIP trunk (Telnyx, Flowroute, VoIP.ms, etc.)

[trunk]
type = endpoint
transport = transport-udp
context = from-trunk
disallow = all
allow = ulaw
allow = alaw
allow = g722
allow = opus
from_user = YOUR_SIP_USERNAME
from_domain = YOUR_SIP_PROVIDER
aors = trunk
auth = trunk-auth
direct_media = no
rtp_symmetric = yes
force_rport = yes
rewrite_contact = yes
; ice_support = yes     ; Enable for WebRTC/NAT traversal
; dtmf_mode = rfc4733   ; DTMF transport method

[trunk-auth]
type = auth
auth_type = userpass
username = YOUR_SIP_USERNAME
password = YOUR_SIP_PASSWORD

[trunk-aor]
type = aor
contact = sip:YOUR_SIP_PROVIDER:5060
qualify_frequency = 30

[trunk-identify]
type = identify
endpoint = trunk
match = YOUR_SIP_PROVIDER_IP

; ===========================================================
; Registration — Register with SIP provider to receive calls
; ===========================================================

[trunk-registration]
type = registration
transport = transport-udp
outbound_auth = trunk-auth
server_uri = sip:YOUR_SIP_PROVIDER
client_uri = sip:YOUR_SIP_USERNAME@YOUR_SIP_PROVIDER
contact_user = YOUR_SIP_USERNAME
retry_interval = 60
max_retries = 10
expiration = 3600

; ===========================================================
; Volunteer SIP phones (for phone-based call preference)
; ===========================================================
; These are internal SIP endpoints for volunteers using SIP
; phones or softphones. Add one section per volunteer.
;
; For PSTN ringing (to cell phones), the bridge originates
; calls via the trunk instead.

; Example volunteer softphone:
;[volunteer-1001]
;type = endpoint
;transport = transport-udp
;context = internal
;disallow = all
;allow = ulaw
;allow = g722
;allow = opus
;auth = volunteer-1001-auth
;aors = volunteer-1001-aor
;direct_media = no
;
;[volunteer-1001-auth]
;type = auth
;auth_type = userpass
;username = 1001
;password = changeme
;
;[volunteer-1001-aor]
;type = aor
;max_contacts = 5
;remove_existing = yes
;qualify_frequency = 30

; ===========================================================
; HTTP Server — Required for ARI WebSocket connections
; ===========================================================
; This is configured in http.conf, not pjsip.conf, but noting
; here for reference. Ensure /etc/asterisk/http.conf has:
;
; [general]
; enabled = yes
; bindaddr = 0.0.0.0
; bindport = 8088
; tlsenable = no         ; Enable TLS in production
; tlsbindaddr = 0.0.0.0:8089
; tlscertfile = /etc/asterisk/keys/asterisk.pem
; tlsprivatekey = /etc/asterisk/keys/asterisk.key
